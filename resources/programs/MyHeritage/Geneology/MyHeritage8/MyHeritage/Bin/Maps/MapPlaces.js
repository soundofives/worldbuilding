var NO_COUNTRY="??";var MAX_NUMBER_OF_PLACES_FOR_SHOWING_ALL=50;var MIN_NUMBER_OF_PLACES_IN_COUNTRY_FOR_WARNING=50;var COMPARISON_DATE_EMPTY=999999999;function isDefined(A){return(typeof (window[A])=="undefined")?false:true}function isCharSetAnsi(C){var B="EN,FR,DE,IT,ES,PT,NL,PB,NO,DA,SV,FI,AF,CA";var A=B.indexOf(C);return(A!=-1)}function getChildElement(C,A){if(!C){return null}var B=C.getElementsByTagName(A);if(!B||B.length<1){return null}return B[0]}function getChildElementsArray(B,A){var C=getChildElement(B,A);if(!C){return null}return C.childNodes}function getXmlChildText(D,A){if(!D){return""}var B=D.getElementsByTagName(A);if(!B||B.length<1||!B[0].childNodes||B[0].childNodes.length<1){return""}var C=B[0].childNodes[0].nodeValue;return C}function addSelectOption(B,D,E){var A=document.createElement("option");try{B.add(A,null)}catch(C){B.add(A)}A.value=D;A.text=E}function replaceNewlineWithBR(D){var A=D;if(A){var E;while((E=A.indexOf("\n"))!=-1){var C=A.substr(0,E);var B=A.substr(E+1);A=C+"<br>"+B}}return A}function fixSingleQuotes(A){return A.replace(/\'/g,"`")}function hoverCoolButton(A){document.getElementById(A+"_L").className="coolButtonLeftHover";document.getElementById(A+"_M").className="coolButtonMiddleHover";document.getElementById(A+"_R").className="coolButtonRightHover"}function restoreCoolButton(A){document.getElementById(A+"_L").className="coolButtonLeft";document.getElementById(A+"_M").className="coolButtonMiddle";document.getElementById(A+"_R").className="coolButtonRight"}function createCoolButtonHtml(A,D,C){var B="<table id='"+A+"' class='coolButton' cellspacing='0' cellpadding='0'\n onclick='"+C+"'\n onMouseOver='hoverCoolButton(\""+A+"\")'\n onMouseOut='restoreCoolButton(\""+A+"\")'>\n  <tr>\n"+(gMap.isRTL()?"    <td id='"+A+"_R' class='coolButtonRight' width='11'>&nbsp;</td>\n":"    <td id='"+A+"_L' class='coolButtonLeft' width='11'>&nbsp;</td>\n")+"    <td id='"+A+"_M' class='coolButtonMiddle' nowrap valign='middle' align='center'>\n      <div class='coolButtonText'>"+D+"</div>\n    </td>\n"+(gMap.isRTL()?"    <td id='"+A+"_L' class='coolButtonLeft' width='11'>&nbsp;</td>\n":"    <td id='"+A+"_R' class='coolButtonRight' width='11'>&nbsp;</td>\n")+"  </tr></table>";return B}function MapIndividual(B,A){this.id=B;this.name=A;this.photo=null;this.gender=null;this.isMinor=false;this.placeIds=null}function MapReference(A,C,D,E,B){this.elementId=A;this.token=C;this.type=D;this.description=E;this.individualIds=new Array();this.photo=B;this.date="";this.dateForComparison=null;this.year=null;this.isHidden=false;this.fact="";this.setDate=function(G,F){this.date=G;this.dateForComparison=F;if(F){var H=F.substr(0,4);if(H<1900){this.year=H-(H%100)}else{if(H<2000){this.year=H-(H%10)}else{if(H<9000){this.year=H}}}}};this.addIndividual=function(F){this.individualIds[F]=1};this.hasIndividual=function(F){if(this.individualIds[F]){return true}else{return false}};this.hasOneOfIndividuals=function(G){if(!G||G.length==0){return true}for(var F=0;F<G.length;F++){if(this.hasIndividual(G[F])){return true}}return false};this.isMatchingFilter=function(F){if(!this.hasOneOfIndividuals(F.arrIndividualIds)){return false}if(F.yearId&&this.year!=F.yearId){return false}if(F.isBirth&&this.type=="B"){return true}if(F.isDeath&&this.type=="D"){return true}if(F.isMarriage&&this.type=="M"){return true}if(F.isResidence&&this.type=="R"){return true}if(F.isPhoto&&this.type=="P"){return true}if(F.isOther&&this.type=="O"){return true}return false};this.isPhoto=function(){return(this.type=="P")};this.isFamily=function(){return(this.elementId.substr(1,1)=="F")}}function MapPlaceMark(D,A,C,B){this.id=D;this.point=A;this.address=C;this.countryCode=B;this.bounds=null}function MapPlace(B,A){this.id=B;this.address=A;this.addressFound="";this.numberOfPlaceMarks=0;this.isVerified=false;this.isPreferredPlaceMarkImproves=false;this.placeMarks=new Array();this.positionOfPreferredPlaceMark=0;this.marker=null;this.references=new Array();this.visibleReferences=0;this.tokens=new Object();this.types="";this.individualIds="";this.years="";this.tooltip="";this.earliestDateForComparisonForIndividual=COMPARISON_DATE_EMPTY;this.referencesForIndividual=null;this.getPreferredPlaceMark=function(){if(this.positionOfPreferredPlaceMark==-1){return null}else{return this.placeMarks[this.positionOfPreferredPlaceMark]}};this.addPlaceMark=function(G,C,F,E){var D=new MapPlaceMark(G,C,F,E);this.placeMarks.push(D);return D};this.hasToken=function(C){return(this.tokens[C])};this.addReference=function(D,G,H,I,F,E){var C=new MapReference(D,G,H,I,F);this.references.push(C);if(!this.hasToken(G)){this.tokens[G]=true}return C};this.isMatchingFilter=function(C){if(C.individualPlaces&&C.individualPlaces[this.id]!=1){return false}if(C.datePlaces&&C.datePlaces[this.id]!=1){return false}if(C.language&&this.language&&this.language!=C.language){return false}if(C.isBirth&&this.types.indexOf("B")!=-1){return true}if(C.isDeath&&this.types.indexOf("D")!=-1){return true}if(C.isMarriage&&this.types.indexOf("M")!=-1){return true}if(C.isResidence&&this.types.indexOf("R")!=-1){return true}if(C.isPhoto&&this.types.indexOf("P")!=-1){return true}if(C.isOther&&this.types.indexOf("O")!=-1){return true}return false};this.setDatesByIndividual=function(E){this.earliestDateForComparisonForIndividual=COMPARISON_DATE_EMPTY;this.referencesForIndividual=new Array();for(iRef=0;iRef<this.references.length;iRef++){var C=this.references[iRef];if(!C||!C.hasIndividual(E)){continue}var D=(C.isFamily()||C.isPhoto())?C.description:C.fact;if(C.date){D+="<br><span class='darkNote'>"+C.date+"</span>"}this.referencesForIndividual.push(D);if(C.dateForComparison&&C.dateForComparison<this.earliestDateForComparisonForIndividual){this.earliestDateForComparisonForIndividual=C.dateForComparison}}return(this.dateForComparison)};this.getCountryCode=function(){var D=NO_COUNTRY;var C=this.getPreferredPlaceMark();if(C){D=C.countryCode}return D};this.getCountryName=function(){if(!this.countryName){var C=this.getCountryCode();if(C==NO_COUNTRY){this.countryName=C}else{this.countryName=gMap.getCountryName(C)}}return this.countryName};this.getStateCode=function(){var D=NO_COUNTRY;var C=this.getPreferredPlaceMark();if(C&&C.stateCode){D=C.stateCode}return D};this.getStateName=function(){if(!this.stateName){var C=this.getCountryCode();var D=this.getStateCode();if(D==NO_COUNTRY){this.stateName=""}else{this.stateName=gMap.getCountryName(C+"_"+D)}}return this.stateName};this.equals=function(C,D){return(this.address==C&&this.language==D)}}function MapCountry(B,A,D,F,H,C,E,G,I){this.code=B;this.name=A;this.count=D;if(F&&H){this.center=new GLatLng(F,H)}else{this.center=null}if(C&&E&&G&&I){this.bounds=new GLatLngBounds(new GLatLng(E,I),new GLatLng(C,G))}else{this.bounds=null}this.visibleCount=0;this.numberOfPlacesWithNoMarker=0}function MapYear(B,A){this.id=B;this.count=A;this.placeIds=null}function MapFilter(){this.isBirth=true;this.isDeath=true;this.isMarriage=true;this.isResidence=true;this.isPhoto=true;this.isOther=true;this.individualId=null;this.relationship=-1;this.yearId=null;this.language=null;this.arrIndividualIds=new Array();this.individualPlaces=null;this.datePlaces=null}function MapPlaces(A){this.map=new GMap2(document.getElementById(A));this.initialize=function(){this.places=new Array();this.placesById=new Array();this.individuals=new Array();this.sortedIndividualIds=new Array();this.selectedIndividualId="";this.years=new Array();this.sortedYears=new Array();this.languages=new Array();this.countries=new Array();this.photos=new Array();this.bounds=new GLatLngBounds();this.currentPosition=-1;this.currentPolylines=new Array();this.xmlTextNode=null;this.xmlDataNode=null;this.textCategories=new Array();this.markersForAlternatePositions=new Array();this.movePlacePolyline=null;this.movePlacePolylineArrow=null;this.waitingForDraggingResponse=false;this.time="";this.totalProgress=0;this.currentProgress=0;this.currentPercent=-1;this.progressWindow=false;this.numberOfVisiblePlaces=0;this.numberOfVisiblePlacesWithMarkers=0;this.numberOfVisiblePlacesWithNoCoordinates=0;this.savedZoom=-1;this.draggedPlace=null;this.removedPlaceId="";this.map.clearOverlays();this.highlightMarker=null;this.isBasicUserWithPartialList=false;this.numberOfAbortedPlaces=0;this.hideLegendLines=false;this.filter=new MapFilter();this.infoWindow=new Object();this.relationshipText=null;this.direction="ltr";this.path=gPath};this.initialize();this.initializeRelationshipTexts=function(){if(!this.relationshipText){this.relationshipText=new Array();this.relationshipText.me=TEXT("This person only");this.relationshipText.ancestors=TEXT("And ancestors");this.relationshipText.descendants=TEXT("And descendants");this.relationshipText.relatives=TEXT("And close family")}};this.isRTL=function(){return(this.direction=="rtl")};this.addIndividual=function(D,C){var B=this.individuals[D];if(!B){B=new MapIndividual(D,C);this.individuals[D]=B;this.sortedIndividualIds.push(D)}else{B.name=C}return B};this.addPlace=function(D,C){var B=new MapPlace(D,C);this.places.push(B);this.placesById[D]=B;return B};this.addAddresses=function(C){for(var B=0;B<C.length;B++){var D=C[B];this.addAddress(D[0],D[1],D[2])}};this.parseText=function(){GDownloadUrl(this.path+"MapText.xml",function(C,B){gMap.parseTextFromXML(C)})};this.parseCountries=function(){GDownloadUrl(this.path+"MapCountries.xml",function(C,B){gMap.parseCountriesFromXML(C)})};this.parseData=function(){GDownloadUrl(this.path+"MapData.xml",function(C,B){gMap.parseAddressesFromXML(C)})};this.parseTime=function(){GDownloadUrl(this.path+"MapTime.xml",function(C,B){gMap.parseTimeFromXML(C)})};this.parseAll=function(){this.parseText();setTimeout("gMap.parseTheRest()",0)};this.parseTheRest=function(){this.parseCountries();this.parseData();this.parseTime();setTimeout("gMap.onTimer()",1000)};this.getText=function(C,D){if(!D){D="Places"}var E="";var B=this.textCategories[D];if(B){E=B[C]}if(!E){E="TODO ["+D+","+C+"]"}return E};this.getData=function(B){return getXmlChildText(this.xmlDataNode,B)};this.getCountryName=function(C){if(!C||C==NO_COUNTRY){return""}var B=C;var D=this.countries[C];if(D){B=D.name}return B};this.parseAddressFromXML=function(F){if(!this.refreshPlace){return }var G=GXml.parse(F);if(!G||!G.documentElement){return }var H=getChildElement(G.documentElement,"place");var J=this.refreshPlace.address;var B=this.refreshPlace.language;var I=getXmlChildText(H,"a");var C=H.getAttribute("l");for(var E=this.places.length-1;E>=0;E--){var K=this.places[E];if(!K){break}if(K.equals(I,C)||K.equals(J,B)){if(K.marker){K.marker.hide();this.map.removeOverlay(K.marker);K.marker=null}this.places.splice(E,1)}}var D=this.parseSingleAddressFromXML(H);D.isVisible=true;this.createMarker(D);this.onSortPlaces();if(D.id==this.removedPlaceId){this.removedPlaceId=""}else{this.onClickPlace(D.id)}};this.parsePlaceMarksXML=function(D,L){D.addressFound=getXmlChildText(L,"f");D.placeMarks.length=0;D.numberOfPlaceMarks=L.getAttribute("marks");D.isVerified=L.getAttribute("verified")?true:false;D.isPreferredPlaceMarkImproves=L.getAttribute("improve")?true:false;D.positionOfPreferredPlaceMark=-1;var C=L.getAttribute("preferred");var N=L.getElementsByTagName("p");if(N){for(var E=0;E<N.length;E++){var M=N[E];if(!M){continue}var B=M.getAttribute("id");var J=parseFloat(M.getAttribute("lat"));var K=parseFloat(M.getAttribute("lng"));var P=getXmlChildText(M,"a");var G=M.getAttribute("c");var O=new GLatLng(J,K);var R=D.addPlaceMark(B,O,P,G);R.stateCode=M.getAttribute("s");R.city=getXmlChildText(M,"city");var F=parseFloat(M.getAttribute("north"));var H=parseFloat(M.getAttribute("south"));var I=parseFloat(M.getAttribute("east"));var Q=parseFloat(M.getAttribute("west"));if(F&&H&&I&&Q){R.bounds=new GLatLngBounds(new GLatLng(H,Q),new GLatLng(F,I))}if(B==C){D.positionOfPreferredPlaceMark=E;this.bounds.extend(O)}}}};this.parseSingleAddressFromXML=function(D){var E=D.getAttribute("id");var C=getXmlChildText(D,"a");var B=this.addPlace(E,C);B.language=D.getAttribute("l");B.types=D.getAttribute("t");B.individualIds=getXmlChildText(D,"i");B.years=getXmlChildText(D,"y");B.refs=D.getAttribute("refs");B.isAddressRefs=D.getAttribute("arefs")?true:false;this.parsePlaceMarksXML(B,D);return B};this.parseTextFromXML=function(R){var E=GXml.parse(R);if(!E||!E.documentElement){return }this.xmlTextNode=getChildElement(E.documentElement,"text");if(!this.xmlTextNode){return }this.textCategories.length=0;var M=this.xmlTextNode.getElementsByTagName("c");for(var H=0;H<M.length;H++){var B=M[H];if(!B){continue}var K=B.getAttribute("n");var N=new Array();this.textCategories[K]=N;var P=B.getElementsByTagName("s");for(var L=0;L<P.length;L++){var T=P[L];if(!T){continue}var S=T.getAttribute("n");var D=T.getAttribute("v");N[S]=D}}document.title=TEXT("title");document.getElementById("birth").innerHTML=TEXT("BIRT","EventsAndFacts");document.getElementById("death").innerHTML=TEXT("Death and burial");document.getElementById("marriage").innerHTML=TEXT("MARR","EventsAndFacts");document.getElementById("residence").innerHTML=TEXT("RESI","EventsAndFacts");document.getElementById("photos").innerHTML=TEXT("Photos","PhotoList");document.getElementById("other").innerHTML=TEXT("Other facts");document.getElementById("show_all_link").innerHTML=TEXT("Show all");document.getElementById("legend2_message").innerHTML=TEXT("Explain drag and drop for any");document.getElementById("print_link").innerHTML=TEXT("Print","ChartView");document.getElementById("open_advanced_search_link").innerHTML=TEXT("Advanced search")+" &#187;";var I=document.getElementById("places_sort");I.options.length=0;addSelectOption(I,"country",TEXT("Sort places by country"));addSelectOption(I,"name",TEXT("Sort places by name"));addSelectOption(I,"count",TEXT("Sort places by references"));this.xmlDataNode=getChildElement(E.documentElement,"data");if(!this.xmlDataNode){return }this.photosFolder=this.getData("photos-folder");this.language=this.getData("lang");this.direction=this.getData("direction");this.projectGUID=this.getData("project-guid");this.projectName=this.getData("project-name");if(this.isRTL()){for(var G=0;G<document.styleSheets.length;G++){var C=document.styleSheets[G];if(C&&C.href&&C.href.substr(0,13)=="MapPlaces.css"){for(iStyle in C.rules){var J=C.rules[iStyle];if(!J){continue}var O=J.style;if(!O){continue}var F=O.left;var Q=O.right;if(F||Q){O.right=F;O.left=Q}F=O.paddingLeft;Q=O.paddingRight;if(F||Q){O.paddingRight=F;O.paddingLeft=Q}if(O.textAlign=="left"){O.textAlign="right"}else{if(O.textAlign=="right"){O.textAlign="left"}}}}}}document.body.dir=this.direction};this.readListFromXML=function(){GDownloadUrl(this.path+"MapList.xml",function(G,D){var B=GXml.parse(G);if(!B||!B.documentElement){return }var F="";var E=B.documentElement.getElementsByTagName("i");for(var C=0;C<E.length;C++){if(F){F+=","}F+=E[C].childNodes[0].nodeValue}gMap.parsedList=F});return gMap.parsedList};this.parseCountriesFromXML=function(F){var G=GXml.parse(F);if(!G||!G.documentElement){return }this.countries.length=0;var N=G.documentElement.getElementsByTagName("country");if(N){for(var P=0;P<N.length;P++){var O=N[P];if(!O){continue}var C=O.getAttribute("code");var H=parseInt(O.getAttribute("count"));var K=parseFloat(O.getAttribute("lat"));var L=parseFloat(O.getAttribute("lng"));var E=parseFloat(O.getAttribute("north"));var I=parseFloat(O.getAttribute("south"));var J=parseFloat(O.getAttribute("east"));var M=parseFloat(O.getAttribute("west"));var B=getXmlChildText(O,"name");var D=new MapCountry(C,B,H,K,L,E,I,J,M);this.countries[C]=D}}};this.parseTimeFromXML=function(C){var B=GXml.parse(C);if(!B||!B.documentElement){return }this.time=B.documentElement.getAttribute("time");gLang=B.documentElement.getAttribute("lang")};this.compareNewTime=function(C){var D=this.time;this.parseTimeFromXML(C);if(this.time!=D){var B=gURL+"?hl="+gLang+"&path="+gPath;location=B}else{setTimeout("gMap.onTimer()",1000)}};this.parseAddressesFromXML=function(G){this.beginProgress();FTBCOM.BeginProgress();this.progressWindow=true;this.showProgress(0);var E=GXml.parse(G);if(!E||!E.documentElement){return }this.isSinglePlace=E.documentElement.getAttribute("single");var H=parseInt(E.documentElement.getAttribute("n"));var C=parseInt(E.documentElement.getAttribute("s"));this.numberOfAbortedPlaces=parseInt(E.documentElement.getAttribute("x"));if(C<H-this.numberOfAbortedPlaces){this.isBasicUserWithPartialList=true}if(this.isBasicUserWithPartialList){document.getElementById("premium_link").innerHTML=TEXT("Upgrade button");document.getElementById("premium_description").innerHTML=TEXT("Upgrade description").replace("%NUMBER%",H);document.getElementById("premium").style.display=""}this.totalProgress=0;var F=getChildElementsArray(E.documentElement,"places");if(F){this.totalProgress+=(2*F.length)}for(var D=0;F&&D<F.length;D++){var I=F[D];if(!I){continue}var B=this.parseSingleAddressFromXML(I);this.incrementProgress()}this.places.sort(this.sortPlacesByCountry);if(this.places.length==0){this.endProgress();document.getElementById("map_canvas").style.display="none";document.getElementById("no_places").style.display=""}else{this.showMap()}};this.sortPlacesByCityAndName=function(C,B){if(!C.cityLowerCase&&C.cityLowerCase!=""){var E=C.getPreferredPlaceMark();if(E&&E.city){C.cityLowerCase=E.city.toLowerCase()}else{C.cityLowerCase=""}}if(!B.cityLowerCase&&B.cityLowerCase!=""){var D=B.getPreferredPlaceMark();if(D&&D.city){B.cityLowerCase=D.city.toLowerCase()}else{B.cityLowerCase=""}}if(!C.cityLowerCase&&B.cityLowerCase){return 1}if(C.cityLowerCase&&!B.cityLowerCase){return -1}if(C.cityLowerCase>B.cityLowerCase){return 1}else{if(C.cityLowerCase<B.cityLowerCase){return -1}}return this.sortPlacesByName(C,B)};this.sortPlacesByName=function(C,B){if(!C.addressLowerCase){C.addressLowerCase=C.address.toLowerCase()}if(!B.addressLowerCase){B.addressLowerCase=B.address.toLowerCase()}if(C.addressLowerCase>B.addressLowerCase){return 1}else{if(C.addressLowerCase<B.addressLowerCase){return -1}else{return 0}}};this.sortPlacesByCount=function(C,B){return(B.refs-C.refs)};this.sortPlacesByCountry=function(E,D){var C=E.getCountryName();var G=D.getCountryName();if(C==G){var B=E.getStateName();var F=D.getStateName();if(!B&&!F||B==F){return gMap.sortPlacesByCityAndName(E,D)}else{if(!B){return 1}else{if(!F){return -1}else{if(B>F){return 1}else{return -1}}}}}else{if(C==NO_COUNTRY){return 1}else{if(G==NO_COUNTRY){return -1}}}if(C==""){return 1}else{if(G==""){return -1}}if(C>G){return 1}else{return -1}};this.sortPlacesByDate=function(C,B){if(C.earliestDateForComparisonForIndividual>B.earliestDateForComparisonForIndividual){return 1}else{if(C.earliestDateForComparisonForIndividual<B.earliestDateForComparisonForIndividual){return -1}else{return gMap.sortPlacesByName(C,B)}}};this.showProgress=function(E,C,F){var B=(!E||!C)?0:((100*E)/C);if(B!=this.currentPercent){var D;if(B<=0){D=""}else{if(B>=100){D=TEXT_COMMON("Button Done")}else{D=""+Math.floor(B)+"%"}}if(F){D+=" "+F}window.status=D;this.currentPercent=B;if(this.progressWindow){FTBCOM.ShowProgress(B)}}};this.beginProgress=function(){this.currentProgress=0;this.currentPercent=0};this.endProgress=function(){this.currentProgress=this.totalProgress;this.showProgress(this.currentProgress,this.totalProgress);this.currentProgress=this.totalProgress=0;if(this.progressWindow){FTBCOM.EndProgress();this.progressWindow=false}};this.incrementProgress=function(B){this.showProgress(this.currentProgress++,this.totalProgress,B)};this.onTimer=function(){if(FTBCOM){FTBCOM.ReportHeartbeat(this.projectGUID)}GDownloadUrl(this.path+"MapTime.xml",function(C,B){gMap.compareNewTime(C)})};this.getCenter=function(){return this.bounds.getCenter()};this.openInfoWindowHtml=function(C,D,B){this.infoWindow.point=C;this.infoWindow.place=this.placesById[D];this.infoWindow.iPlaceMark=B;this.infoWindow.allowFixingGoodPlace=false;this.infoWindow.showAllReferences=false;this.showInfoWindow()};this.showInfoWindow=function(){this.infoWindow.html=this.getInfoWindowHtml();this.map.savePosition();this.savedZoom=this.map.getZoom();if(this.infoWindow.point){this.onCloseCallout();var C=new Object();C.onCloseFn=function(){gMap.onCloseInfoWindow()};this.map.openInfoWindowHtml(this.infoWindow.point,this.infoWindow.html,C)}else{this.map.closeInfoWindow();var G=document.getElementById("calloutWindow");var F=document.getElementById("map_canvas");var B=F.style.width;if(B&&B.substr(B.length-2)=="px"){B=parseInt(B.substr(0,B.length-2));var D=320;var E=(B-D)/2;if(this.isRTL()){G.style.right=E}else{G.style.left=E}}G.style.display="";document.getElementById("calloutWindow").style.display="";document.getElementById("callout").innerHTML=this.infoWindow.html}};this.onCloseInfoWindow=function(){if(this.map.getZoom()==this.savedZoom){this.map.returnToSavedPosition()}};this.onMarkerDragStart=function(B){if(this.movePlacePolyline){this.movePlacePolyline.hide();this.movePlacePolyline=null}if(this.movePlacePolylineArrow){this.movePlacePolylineArrow.hide();this.movePlacePolylineArrow=null}};this.onMarkerDragEnd=function(C){if(!C||!C.baseMarker){return }if(!testFTB()){return }var B=this.placesById[C.baseMarker.placeId];if(!B){return }var F=new Array();F.push(C.baseMarker.getLatLng());F.push(C.getLatLng());this.movePlacePolyline=new GPolyline(F,"#000000",2);this.map.addOverlay(this.movePlacePolyline);this.movePlacePolylineArrow=this.createArrowHeadPolyline(F,8,"#000000",2);this.map.addOverlay(this.movePlacePolylineArrow);this.draggedPlace=B;this.draggedPlace.moveTo=C.getLatLng();this.movePlacePolyline.show();this.movePlacePolylineArrow.show();var E="<div style='padding-top:10px' class='address'>"+TEXT("Confirm moving place").replace("%PLACE%",B.address)+"</div>";E+="<div style='padding-top:20px'><center>";E+="<table cellpadding='0' cellspacing='0'><tr><td>";E+="<td>"+createCoolButtonHtml("editOKButton",TEXT_COMMON("Button OK"),"gMap.onAcceptMovePlace()")+"</td>";E+="<td>&nbsp;&nbsp;&nbsp;</td>";E+="<td><a href='javascript:gMap.onCancelMovePlace()'>"+TEXT_COMMON("Button Cancel")+"</a></td>";E+="</tr></table>";E+="</center></div>";var D=new Object();D.onCloseFn=function(){gMap.onCloseMovePlace()};D.noCloseOnClick=true;this.map.openInfoWindowHtml(C.getLatLng(),E,D);this.beginWaitForDraggingResponse()};this.beginWaitForDraggingResponse=function(){this.waitingForDraggingResponse=true;for(var C=0;C<this.places.length;C++){var B=this.places[C];if(B&&B.marker){B.marker.disableDragging()}}};this.endWaitForDraggingResponse=function(){this.waitingForDraggingResponse=false;this.removeHighlightMarker();this.movePlacePolyline.hide();this.movePlacePolylineArrow.hide();for(var C=0;C<this.places.length;C++){var B=this.places[C];if(B&&B.marker){B.marker.enableDragging()}}};this.onAcceptMovePlace=function(){this.endWaitForDraggingResponse();if(!this.draggedPlace){this.map.closeInfoWindow();return }var B=this.draggedPlace.moveTo;this.map.closeInfoWindow();if(FTBCOM.ChangePlaceCoordinates(this.draggedPlace.address,this.draggedPlace.language,B.lat(),B.lng())){this.refreshMap(this.draggedPlace)}};this.onCancelMovePlace=function(){this.map.closeInfoWindow()};this.onCloseMovePlace=function(){this.endWaitForDraggingResponse();if(!this.draggedPlace){return }var B=this.draggedPlace.marker;if(!B){return }};this.onChangeCoordinates=function(){var C=this.infoWindow.place;var D=document.forms.changeCoordinates;var B=FTBCOM.ChangePlaceCoordinates(C.address,C.language,D.lat.value,D.lng.value);this.onBackFromAlternatives(C.id);if(B){this.refreshMap(C)}};this.getHightlightMarkerZOrder=function(B){return GOverlay.getZIndex(-90)};this.removeHighlightMarker=function(){if(this.highlightMarker){this.highlightMarker.hide();this.map.removeOverlay(this.highlightMarker);this.highlightMarker=null}};this.createHighlightMarker=function(C){this.removeHighlightMarker();var D=new Object;D.title=C.getTitle();D.icon=new GIcon(G_DEFAULT_ICON);D.icon.image=D.icon.printImage="markerSelected.gif";D.draggable=(C.iPlaceMark==-1);D.zIndexProcess=gMap.getHightlightMarkerZOrder;var B=new GMarker(C.getLatLng(),D);B.baseMarker=C;B.enableDragging();GEvent.addListener(B,"click",function(){if(!gMap.waitingForDraggingResponse){gMap.openInfoWindowHtml(B.getLatLng(),B.baseMarker.placeId,B.baseMarker.iPlaceMark);gMap.ensurePlaceVisibleInList(B.baseMarker.placeId)}});GEvent.addListener(B,"mouseover",function(){var E=(B.baseMarker.iPlaceMark!=-1?B.baseMarker.iPlaceMark:B.baseMarker.placeId);gMap.highlightSideBar(E,"sideBarHighlightHover")});GEvent.addListener(B,"mouseout",function(){var E=(B.baseMarker.iPlaceMark!=-1?B.baseMarker.iPlaceMark:B.baseMarker.placeId);gMap.highlightSideBar(E,"sideBar");if(!gMap.waitingForDraggingResponse){B.hide()}});GEvent.addListener(B,"dragstart",function(){if(B.baseMarker.iPlaceMark==-1){gMap.onMarkerDragStart(B)}});GEvent.addListener(B,"dragend",function(){if(B.baseMarker.iPlaceMark==-1){gMap.onMarkerDragEnd(B)}});this.map.addOverlay(B);this.highlightMarker=B};this.createMarker=function(E){if(!E){return }var D=E.getPreferredPlaceMark();if(!D){return }var B=D.point;if(!B){return }if(!E.tooltip){this.calculateTooltip(E)}var F=new Object;F.title=E.tooltip;F.icon=new GIcon(G_DEFAULT_ICON);F.icon.image=F.icon.printImage="markerNormal.gif";F.draggable=true;var C=new GMarker(B,F);C.address=E.address;C.placeId=E.id;C.iPlaceMark=-1;GEvent.addListener(C,"click",function(){if(!gMap.waitingForDraggingResponse){gMap.openInfoWindowHtml(C.getLatLng(),C.placeId,-1)}});GEvent.addListener(C,"mouseover",function(){if(!gMap.waitingForDraggingResponse){gMap.createHighlightMarker(C)}});E.marker=C;this.map.addOverlay(C);return C};this.showFullPhoto=function(C){var D=this.photos[C];if(!D){return }var I=D.width;var B=D.height;if(B>256){var H=B/256;B=256;I/=H}var F="<div id='fullPhotoHeader'><div class='address'>"+D.description+"</div></div><div id='fullPhotoBody'><span class='photoBorder' style='width:"+(I+6)+"px; height="+(B+6)+"px'><img src='"+this.photosFolder+D.file+"' width='"+I+"' height='"+B+"'></span></div><div id='fullPhotoFooter'><a href='javascript:gMap.hideFullPhoto()'>"+TEXT("Close photo")+"</a><span class='note'>&nbsp;&nbsp;|&nbsp;&nbsp;</span><a href='javascript:gMap.editPhotoDetails(\""+C+"\")'>"+TEXT("Edit photo details")+"</a></div>";var G=new GInfoWindowTab("tab",F);var E=new Array();E.push(G);this.map.updateInfoWindow(E)};this.hideFullPhoto=function(){var C=new GInfoWindowTab("tab",this.infoWindow.html);var B=new Array();B.push(C);this.map.updateInfoWindow(B)};this.editPhotoDetails=function(B){this.hideFullPhoto();if(!testFTB()){return }FTBCOM.EditPhotoPlace(B)};this.getImageHtml=function(C,E){C.description=E;var B=Math.min(42,C.thumbnailHeight);var D="<span class='photoBorder' style='height:"+(B+6)+"px'><img alt='"+TEXT("Click to enlarge photo")+"' src='"+this.photosFolder+C.thumbnail+"' height='"+B+"' onclick='gMap.showFullPhoto(\""+C.id+"\")' style='cursor:hand'></span>";return D};this.parsePlaceReferences=function(T){var F=GXml.parse(T);if(!F||!F.documentElement){return false}var H=F.documentElement.getAttribute("id");var L=this.placesById[H];if(!L){return false}var O=F.documentElement.getElementsByTagName("ref");if(!O){return false}for(var G=0;G<O.length;G++){var B=O[G];if(!B||!B.childNodes||B.childNodes.length<1){continue}var Q=getXmlChildText(B,"name");var M=B.getAttribute("id");var K=B.getAttribute("token");var E=B.getAttribute("type");var D=this.getPhotoFromXmlElement(B);var I=L.addReference(M,K,E,Q,D);I.fact=getXmlChildText(B,"fact");var R=getXmlChildText(B,"date");var S=getXmlChildText(B,"dc");I.setDate(R,S);var C=B.getElementsByTagName("i");if(C){for(var J=0;J<C.length;J++){var N=C[J];if(!N){continue}var P=N.getAttribute("id");if(P){I.addIndividual(P)}}}}return true};this.readPlaceReferences=function(B){var C=B.references.length;if(C>0){return true}if(!FTBCOM.GetReferences(B.address,B.language,B.id)){return false}GDownloadUrl(this.path+"MapRefs.xml",function(E,D){gMap.parsePlaceReferences(E)});return true};this.parsePlacePlaceMarks=function(E){var C=GXml.parse(E);if(!C||!C.documentElement){return false}var D=C.documentElement.getAttribute("id");var B=this.placesById[D];if(!B){return false}xmlPlace=getChildElement(C.documentElement,"place");if(!xmlPlace){return false}this.parsePlaceMarksXML(B,xmlPlace);return true};this.readPlacePlaceMarks=function(B){if(B.numberOfPlaceMarks==B.placeMarks.length){return true}if(!FTBCOM.GetPlaceMarks(B.address,B.language,B.id)){return false}GDownloadUrl(this.path+"MapPlaceMarks.xml",function(D,C){gMap.parsePlacePlaceMarks(D)});return true};this.parseIndividual=function(E){var D=GXml.parse(E);if(!D||!D.documentElement){return false}var F=D.documentElement.getAttribute("id");var B=this.individuals[F];if(!B){var C=getXmlChildText(D.documentElement,"name");B=this.addIndividual(F,C)}B.gender=D.documentElement.getAttribute("g");B.photo=this.getPhotoFromXmlElement(D.documentElement);B.isMinor=D.documentElement.getAttribute("minor")?true:false;B.placeIds=getXmlChildText(D.documentElement,"p").split(",");return true};this.readIndividual=function(C){if(!C){return null}var B=this.individuals[C];if(B&&B.gender&&B.placeIds){return B}if(!FTBCOM.GetPersonDetails(C)){return null}GDownloadUrl(this.path+"MapPerson.xml",function(E,D){gMap.parseIndividual(E)});var B=this.individuals[C];return B};this.parseYear=function(E){var B=GXml.parse(E);if(!B||!B.documentElement){return false}var D=B.documentElement.getAttribute("id");var C=this.years[D];if(!C){return false}C.placeIds=getXmlChildText(B.documentElement,"p").split(",");return true};this.readYear=function(B){if(!B){return false}if(B.placeIds){return true}if(!FTBCOM.GetYear(B.id)){return false}GDownloadUrl(this.path+"MapYear.xml",function(D,C){gMap.parseYear(D)});return true};this.getInfoWindowHtml=function(){var P=this.infoWindow.place;var W=this.infoWindow.iPlaceMark;if(!P){return""}this.readPlaceReferences(P);this.readPlacePlaceMarks(P);var b="";var H=P.references.length;var C=new Array();if(W==-1){var F=false;for(iRef=0;iRef<H;iRef++){var M=P.references[iRef];if(!M||M.isHidden){continue}if(!this.infoWindow.showAllReferences&&!M.isMatchingFilter(this.filter)){continue}var E=new Object();E.images="";E.description="";var I=M.isPhoto();if(I){if(M.photo){E.images=this.getImageHtml(M.photo,M.description)}}else{for(var V in M.individualIds){var X=this.readIndividual(V);if(!X||!X.photo){continue}if(E.images){E.images+=" "}E.images+=this.getImageHtml(X.photo,X.name)}}if(E.images){F=true}var N;if(I&&M.photo){N='gMap.showFullPhoto("'+M.photo.id+'")'}else{N='gMap.onEditFact("'+M.elementId+'","'+M.token+'")'}E.description+="<a href='javascript:"+N+"'>"+M.description+"</a>";if(M.date){E.description+="<br>"+M.date}C.push(E)}var c=new Array();for(iRef=0;iRef<C.length;iRef++){var E=C[iRef];c.push("<tr>");var D=(iRef<C.length-1)?"":"Last";var a=(E.description?E.description:"&nbsp;");if(F){var R=(E.images?E.images:"&nbsp");c.push("<td valign='top' align='center' nowrap class='referenceImage"+D+"'>"+R+"</td>");c.push("<td valign='top' class='referenceDescriptionWithPhotos"+D+"'>"+a+"</td>")}else{c.push("<td valign='top' class='referenceDescription"+D+"'>"+a+"</td>")}c.push("</tr>")}b+=c.join("")}var G=P.address;var e=null;if(W!=-1&&W<P.placeMarks.length){e=P.placeMarks[W]}var O=null;if(!e){O=P.getPreferredPlaceMark()}var Y=new Array();Y.push("<div id='info_window_div'>");var d=G;if(e){d=e.address}Y.push("<div id='calloutHeader'>");Y.push("<table cellpadding='0' cellspacing='0'><tr>");Y.push("<td class='address' valign='top'>"+d+"</td>");if(O){Y.push("<td width='5'></td>");Y.push("<td valign='top'><img id='zoomIn' src='zoominIcon.gif' onClick='gMap.onZoomInPlace()' style='cursor:pointer' title='"+TEXT("Zoom In","EditPhoto")+"'></td>")}Y.push("</tr></table>");Y.push("</div>");if(e){Y.push("<div style='padding-top:2px; padding-bottom:2px'>");Y.push(createCoolButtonHtml("acceptSuggestionButton",TEXT("Use alternative location"),"gMap.onClickAcceptAlternatePlacemark()"));Y.push("</div>")}else{Y.push("<div id='calloutMain'></div>");Y.push("<table cellpadding='0' cellspacing='0' width='100%'>");var T;var L=0;var B=false;if(O){if((!P.isVerified||this.infoWindow.allowFixingGoodPlace)&&O.address&&O.address!=G){var J=G.indexOf(P.addressFound);if(J>0){Y.push("<tr class='infoWindowRow'>");Y.push("<td colspan='2'>"+TEXT("Located on map tootip").replace("%PLACE%",P.addressFound)+"</td>");Y.push("</tr>");L++}if(P.isPreferredPlaceMarkImproves){T=TEXT("Change to name");T=T.replace("%NAME%",O.address);Y.push("<tr class='infoWindowRow'>");Y.push("<td valign='top' class='infoWindowIcon'><img class='infoWindowImage' src='changeToIcon.gif' onclick='gMap.onUsePreferredPlaceMarkAddress()'></td>");Y.push("<td valign='top' width='100%'><a href='javascript:gMap.onUsePreferredPlaceMarkAddress()'><b>"+T+"</b></a></td>");Y.push("</tr>");L++;T=TEXT("Select to keep name");T=T.replace("%NAME%",d);Y.push("<tr class='infoWindowRow'>");Y.push("<td valign='top' class='infoWindowIcon'><img class='infoWindowImage' src='confirmIcon.gif' onclick='gMap.onKeepExistingAddress()'></td>");Y.push("<td valign='top' width='100%'><a href='javascript:gMap.onKeepExistingAddress()'>"+T+"</a></td>");Y.push("</tr>");L++}}else{if(!this.infoWindow.allowFixingGoodPlace){B=true;Y.push("<tr class='infoWindowRow'>");Y.push("<td colspan='2'><a href='javascript:gMap.onFixGoodPlace()'>"+TEXT("Fix good place")+"</a></td>");Y.push("</tr>");L++}}}if(!O){T=TEXT("Not on the map");Y.push("<tr class='infoWindowRow'>");Y.push("<td colspan='2' class='note'>"+T+"</td>");Y.push("</tr>")}if(this.infoWindow.allowFixingGoodPlace||(!B&&!P.isVerified)){if(P.placeMarks.length>1){var K=P.placeMarks.length-1;if(K==1){T=TEXT("Alternative location")}else{T=TEXT("Alternative locations");T=T.replace("%NUMBER%",K)}}else{T=TEXT("Change coordinates")}T="<a href='javascript:gMap.onClickAlternatePlacemarks()'>"+T+"</a>";Y.push("<tr id='choose-alternate-place' class='infoWindowRow'>");Y.push("<td valign='top' class='infoWindowIcon'><img class='infoWindowImage' src='chooseAlternate.gif' onclick='gMap.onClickAlternatePlacemarks()'></td>");Y.push("<td valign='top' width='100%'>"+T+"</td>");Y.push("</tr>");L++}if(!B){T="<a href='javascript:gMap.onEditPlace()'>"+TEXT("Edit place")+"</a>";Y.push("<tr id='edit-place-link' class='infoWindowRow'>");Y.push(" <td class='infoWindowIcon'><img class='infoWindowImage' src='editIcon.gif' onclick='gMap.onEditPlace()'></td>");Y.push(" <td width='100%'>"+T+"</td>");Y.push("</tr>");Y.push("<tr id='edit-place-area' class='infoWindowEditRow' style='display:none'>");Y.push(" <td valign='top' class='infoWindowIcon'><img class='infoWindowImage' src='editIcon.gif'></td>");Y.push(" <td valign='top' width='100%'>");Y.push("  <table cellpadding='0' cellspacing='0'>");Y.push("   <tr>");Y.push("    <td><input style='display:none'></td>");Y.push("    <td><input id='edit_place' name='edit_place' value='"+G+"' size='28'/>&nbsp;</td>");Y.push("    <td>"+createCoolButtonHtml("editOKButton",TEXT_COMMON("Button OK"),"gMap.onApplyEditPlace()")+"</td>");Y.push("    <td>&nbsp;&nbsp;</td>");Y.push("    <td><a href='javascript:gMap.onCancelEditPlace()'>"+TEXT_COMMON("Button Cancel")+"</a></td>");Y.push("   </tr>");Y.push("  </table>");Y.push(" </td>");Y.push("</tr>");L++}if(!B&&O){T="<a href='javascript:gMap.onRemoveFromMap()'>"+TEXT("Remove from map")+"</a>";Y.push("<tr id='remove-place' class='infoWindowRow'>");Y.push(" <td valign='top' class='infoWindowIcon'><img class='infoWindowImage' src='removeIcon.gif' onclick='gMap.onRemoveFromMap()'></td>");Y.push(" <td valign='top' width='100%'>"+T+"</td>");Y.push("</tr>");L++}Y.push("</table>")}if(b){Y.push("<p>");var S="inThisPlacePanel";if(C.length>3){S+="Scroll"}Y.push("<table id='"+S+"' cellpadding='0' cellspacing='0' width='100%'><tr>");Y.push("<td><b>"+TEXT("In this place:")+"</b></td>");if(C.length<H){Y.push("<td id='showAllReferences'>("+TEXT("X of Y").replace("%NUMBER%",C.length).replace("%TOTAL%",H)+")");Y.push("<a href='javascript:gMap.onShowAllReferencesOfPlace()'>");Y.push(TEXT("Show all")+" &#187;");Y.push("</td>")}Y.push("</tr></table>");if(C.length>3){var Z=document.getElementById("map_canvas");var U=parseInt(Z.style.height.replace("px",""));Y.push("<div id='info_window_references' class='infoWindowReferencesScroll'>");Y.push("<table cellpadding='0' cellspacing='0' width='280'>"+b+"</table>");Y.push("</div>")}else{Y.push("<div id='info_window_references' class='infoWindowReferences'>");Y.push("<table cellpadding='0' cellspacing='0' width='300'>"+b+"</table>");Y.push("</div>")}}Y.push("</div>");var Q=Y.join("\n");return Q};this.onEditFact=function(C,D){this.map.closeInfoWindow();if(!testFTB()){return }var B=this.infoWindow.place;if(!B){return }if(FTBCOM.EditFact(B.address,B.language,B.id,C,D)){location.reload()}};this.showMap=function(){this.map.setCenter(this.getCenter(),5);this.map.addControl(new GLargeMapControl3D());this.map.addControl(new GMapTypeControl());var D=this.map.getBoundsZoomLevel(this.bounds);D=Math.min(D,10);this.map.setZoom(D);this.map.panTo(this.bounds.getCenter());var C=new Array();this.showAreasBasedOnSinglePlace();document.getElementById("alternativesPanel").style.display="none";document.getElementById("places_sort_label").innerHTML=TEXT("Sort places by");if(this.isSinglePlace&&this.places.length>0){var B=this.places[0];if(B){document.getElementById("single_note").innerHTML=TEXT("Single address note");document.getElementById("single_address").innerHTML=B.address;if(B.addressFound&&B.address.indexOf(B.addressFound)>0){document.getElementById("single_address_note").innerHTML="("+B.addressFound+")"}document.getElementById("single_button_area").innerHTML=createCoolButtonHtml("singlePlaceButton",TEXT("Single address button"),"gMap.onBackFromSingleAddress()")}}this.filterPlaces()};this.showVisiblePlaces=function(){var Q="--";var m="--";var P=0;var I=new Array();I.push("<div class='sideBarArea'>");var a=document.getElementById("select_individual").value;var U=document.getElementById("select_relationship").value;var Z=null;var H=document.getElementById("individualPanel");var N=false;if(a){Z=this.individuals[a];N=(U=="me")}var g=document.getElementById("places_sort");if(Z){this.readIndividual(a);var h=new Array();h.push("<table width='100%' cellpadding='0' cellspacing='0'><tr>");var c=80;var j="";if(Z.photo){c=Math.min(80,Z.photo.height);j=this.photosFolder+Z.photo.file}else{j="../../res/_Placeholder"+Z.gender+"3";if(Z.isMinor){j+="y"}j+=".JPG"}h.push("<td valign='top' id='individualPhoto'>");h.push("<span class='photoBorder' style='height:"+(c+6)+"px'>");h.push("<img src='"+j+"' height='"+c+"'>");h.push("</span>");h.push("</td>");h.push("<td valign='top' width='100%'>");h.push("<div id='individualName'>"+Z.name+"</div>");h.push("<div>"+Z.lifeSpan+"</div>");if(!N){this.initializeRelationshipTexts();h.push("<div style='padding-top: 2px'>"+this.relationshipText[U]+"</div>")}h.push("</td></tr></table>");H.innerHTML=h.join("");if(H.style.display=="none"){H.style.display="";onResizeWindow()}}else{if(H.style.display==""){H.style.display="none";onResizeWindow()}}if(N){if(g.options.length==3){addSelectOption(g,"date",TEXT("Sort places by date"))}if(g.selectedIndex==3){this.sortPlaces()}}else{if(g.selectedIndex==3){g.selectedIndex=0;this.sortPlaces()}g.options.length=3}var V=g.value;var C=null;var R=null;for(var D=0;D<this.places.length;D++){var E=this.places[D];if(!E){continue}if(!E.tooltip){this.calculateTooltip(E)}if(E.isVisible){var i=E.address;if(E.addressFound){var S=i.indexOf(E.addressFound);if(S>0||(S>=0&&E.addressFound.length<i.length)){var J=i.substr(0,S);var F=i.substr(S,E.addressFound.length);var n="";if(S+E.addressFound.length<i.length){n=i.substr(S+E.addressFound.length)}i="<span class='sideBarGray'>"+J+"</span>"+F;if(n){i+="<span class='sideBarGray'>"+n+"</span>"}}}var W=i;if(V=="country"){var e=E.getCountryCode();var T=E.getStateCode();if(e!=Q){var l=E.getCountryName();C=this.countries[e];R=null;if(Q!="--"){I.push("<div class='sideBarSeparator'>")}else{I.push("<div>")}if(!e){I.push("<div class='sideBarCountry'><b>"+TEXT("Places not in a state")+"</b></div>")}else{if(e==NO_COUNTRY){I.push("<div class='sideBarCountry'><b>"+TEXT("Places not on the map")+"</b></div>")}else{I.push("<table class='sideBarCountry' cellpadding='0' cellspacing='0' width='100%'></tr>");var O='gMap.onShowAllPinsOfCountry("'+e+'")';var Y=this.getText("Map all places in area").replace("%AREA%",fixSingleQuotes(l));I.push("<td><a href='javascript:"+O+"' title='"+Y+"'><b>"+l+"</b></a></td>");I.push("<td id='show_all_country_pins_"+e+"' class='map-all'>");I.push("<img src='pinNormal.gif' border='0' onclick='"+O+"' style='cursor:pointer'>&nbsp;");I.push("<a href='javascript:"+O+"' title='"+Y+"'>"+TEXT("Show all pins")+"</a></td>");I.push("</td>");I.push("</tr></table>");if(C){C.numberOfPlacesWithNoMarker=0}}}I.push("</div>");Q=e;P=0}if((e=="US"||e=="CA")&&(T!=m)){var d=E.getStateName();var B=e+"_"+T;R=this.countries[B];I.push("<div class='sideBarStateSeparator'>");if(T!=NO_COUNTRY){var O='gMap.onShowAllPinsOfCountry("'+e+'", "'+T+'")';var Y=this.getText("Map all places in area").replace("%AREA%",fixSingleQuotes(d));I.push("<div class='sideBarRow'>");I.push(" <table class='sideBarState' cellpadding='0' cellspacing='0'>");I.push("  <tr>");I.push("   <td><a href='javascript:"+O+"' title='"+Y+"'>"+d+"</a></td>");I.push("   <td id='show_all_country_pins_"+B+"' class='map-all'>");I.push("    <img src='pinNormal.gif' border='0' onclick='"+O+"' style='cursor:pointer'>&nbsp;");I.push("    <a href='javascript:"+O+"' title='"+Y+"'>"+TEXT("Show all pins")+"</a></td>");I.push("   </td>");I.push("  </tr>");I.push(" </table>");I.push("</div>");if(R){R.numberOfPlacesWithNoMarker=0}}else{I.push("<div class='sideBarRow'>");I.push(" <div class='sideBarState'>"+TEXT("Places not in a state")+"</div>");I.push("</div>")}I.push("</div>");P=0;m=T}P++}var M="<div class='sideBarRow' id='sideBarRow_"+E.id+"'>";M+="<div class='sideBarPlaceRow'>";var k=E.getPreferredPlaceMark();if(k){if(P==1||this.numberOfVisiblePlaces<=MAX_NUMBER_OF_PLACES_FOR_SHOWING_ALL){if(!E.marker){this.createMarker(E);this.numberOfVisiblePlacesWithMarkers++}}if(E.marker){W="<img id='sideBarImage_"+E.id+"' border='0' src='pinNormal.gif'>&nbsp;"+W}else{W="<img id='sideBarImage_"+E.id+"' border='0' src='pinEmpty.gif' title='"+TEXT("Click to show on map")+"'>&nbsp;"+W;if(C){C.numberOfPlacesWithNoMarker++}if(R){R.numberOfPlacesWithNoMarker++}}if(E.isPreferredPlaceMarkImproves&&!E.isVerified){W+="&nbsp;<img border='0' src='exclamationMark.gif' title='"+TEXT("Improve place")+"'>"}M+="<a id='sideBar_"+E.id+"' class='sideBar' ";M+="href='javascript:gMap.onClickPlace("+E.id+")' ";M+="onmouseover='gMap.onMouseOverPlace("+E.id+")' ";M+="onmouseout='gMap.onMouseOutPlace("+E.id+")'";M+=">"+W+"</a>"}else{M+="<span class='sideBarDash'>-</span>";M+="<a id='sideBar_"+E.id+"' class='sideBar' ";M+="href='javascript:gMap.onClickPlace("+E.id+")' ";M+="onmouseover='gMap.onMouseOverPlace("+E.id+")' ";M+="><span class='sideBarGray'>"+W+"</span></a>"}M+="</div>";if(Z&&N){var K="";if(E.referencesForIndividual&&E.referencesForIndividual.length>0){M+="<div class='sideBarFacts'>";for(var X=0;X<E.referencesForIndividual.length;X++){M+="<div class='sideBarFact'>- "+E.referencesForIndividual[X]+"</div>"}M+="</div>"}}M+="</div>";I.push(M)}this.incrementProgress()}I.push("</div>");var L=(this.numberOfVisiblePlaces<this.places.length);document.getElementById("places_text").innerHTML=I.join("");document.getElementById("show_all_places").style.display=L?"":"none";for(var e in this.countries){var f=this.countries[e];if(f&&f.numberOfPlacesWithNoMarker==0){var G=document.getElementById("show_all_country_pins_"+e);if(G){G.style.display="none"}}}if(!this.isSinglePlace){document.getElementById("placesSortPanel").style.display=(this.numberOfVisiblePlaces==0)?"none":""}var b="Places displayed ";if(this.numberOfVisiblePlaces==0){b+="0"}else{if(this.numberOfVisiblePlaces==1){b+="1"}else{b+="N"}}if(L){if(this.places.length==1){b+=" of 1"}else{b+=" of N"}}var W=TEXT(b);W=W.replace("%DISPLAYED%",this.numberOfVisiblePlaces);if(L){W=W.replace("%ALL%",this.places.length)}if(this.numberOfAbortedPlaces>0){W+="<div id='canceled_places'>";if(this.numberOfAbortedPlaces==1){W+=TEXT("One canceled")}else{W+=TEXT("Number canceled").replace("%NUMBER%",this.numberOfAbortedPlaces)}W+="</div>"}document.getElementById("places_header").innerHTML=W;this.showNumberOfPinsOnTheMap();FTBCOM.SetNumberOfVisiblePlaces(this.numberOfVisiblePlaces);this.endProgress()};this.showNumberOfPinsOnTheMap=function(){var B="";if(this.numberOfVisiblePlacesWithMarkers<this.numberOfVisiblePlaces-this.numberOfVisiblePlacesWithNoCoordinates){B="<img src='pinNormal.gif'>&nbsp;";if(this.numberOfVisiblePlacesWithMarkers==1){B+=TEXT("Pin on map")}else{B+=TEXT("Pins on map").replace("%NUMBER%",this.numberOfVisiblePlacesWithMarkers)}}document.getElementById("pins_header").innerHTML=B};this.removePolylines=function(){for(var B=0;B<this.currentPolylines.length;B++){this.currentPolylines[B].hide()}this.currentPolylines=new Array()};this.showPolylines=function(B){for(var D=0;D<this.currentPolylines.length;D++){var C=this.currentPolylines[D];if(B){C.show()}else{C.hide()}}};this.showOnePolyline=function(D){for(var C=0;C<this.currentPolylines.length;C++){var B=this.currentPolylines[C];if(D==C){B.show()}else{B.hide()}}};this.setLegend=function(B){var C=document.getElementById("legend");if(C){C.innerHTML=B;C.style.display=B?"":"none"}};this.showLegend2=function(B){document.getElementById("legend2_message").innerHTML=(B?TEXT("Explain drag and drop for any"):"")};this.onFilterType=function(B){this.onFilter()};this.onCheckFilter=function(B){document.getElementById(B).checked=!document.getElementById(B).checked;this.onFilterType(B)};this.onSelectIndividual=function(){var B=document.getElementById("select_individual");if(B&&B.length>0&&B.options[0].value=="*"){B.remove(0)}document.getElementById("select_relationship").selectedIndex=0;this.onFilter()};this.parseIndividualsInLetter=function(F){var C=GXml.parse(F);if(!C||!C.documentElement){return }var B=getChildElementsArray(C.documentElement,"individuals");var E=C.documentElement.getAttribute("begins");var D=document.getElementById("select_individual");D.options.length=0;addSelectOption(D,"*","-- "+TEXT("Select name").replace("%LETTER%",E)+" --");this.readIndividuals(B,false);document.getElementById("calculating_individuals").style.display="none";D.style.display=""};this.getIndividualsInLetter=function(B){if(FTBCOM.GetPeople(B)){GDownloadUrl(this.path+"MapSearch.xml",function(D,C){gMap.parseIndividualsInLetter(D)})}};this.onSelectLetter=function(){var D=document.getElementById("select_individual_letters").value;if(D){if(!testFTB()){return }document.getElementById("select_individual").style.display="none";document.getElementById("select_relationship").style.display="none";var E=TEXT("Loading names").replace("%LETTER%",D)+"...";var B=document.getElementById("calculating_individuals");B.innerHTML="<i>"+E+"</i>";B.style.display="";setTimeout("gMap.getIndividualsInLetter('"+D+"')",1)}else{var C=document.getElementById("select_individual");C.options.length=0;C.style.display="none";document.getElementById("select_relationship").style.display="none";this.onFilter()}};this.onFilter=function(){this.map.closeInfoWindow();this.totalProgress=this.places.length;this.beginProgress();this.filterPlaces()};this.readFilter=function(){this.filter.isBirth=document.getElementById("check_birth").checked;this.filter.isDeath=document.getElementById("check_death").checked;this.filter.isMarriage=document.getElementById("check_marriage").checked;this.filter.isResidence=document.getElementById("check_residence").checked;this.filter.isPhoto=document.getElementById("check_photo").checked;this.filter.isOther=document.getElementById("check_other").checked;var D=document.getElementById("advanced_search");this.filter.isAdvancedSearch=D&&(D.style.display=="");this.filter.individualId=this.filter.isAdvancedSearch?document.getElementById("select_individual").value:"";this.filter.relationship=this.filter.isAdvancedSearch?document.getElementById("select_relationship").value:"";this.filter.yearId=this.filter.isAdvancedSearch?document.getElementById("select_year").value:"";this.filter.language=this.filter.isAdvancedSearch?document.getElementById("select_language").value:"";this.filter.arrIndividualIds=new Array();this.filter.individualPlaces=null;this.filter.datePlaces=null;if(this.filter.individualId){this.filter.individualPlaces=new Array();var F=this.filter.individualId;document.getElementById("select_relationship").style.display="";var B=this.individuals[this.filter.individualId];if(B){if(this.filter.relationship=="ancestors"){if(B.ancestors==null){if(FTBCOM.GetAncestors(B.id)){B.ancestors=this.readListFromXML()}}if(B.ancestors){F+=","+B.ancestors}}else{if(this.filter.relationship=="descendants"){if(B.descendants==null){if(FTBCOM.GetDescendants(B.id)){B.descendants=this.readListFromXML()}}if(B.descendants){F+=","+B.descendants}}else{if(this.filter.relationship=="relatives"){if(B.relatives==null){if(FTBCOM.GetCloseRelatives(B.id)){B.relatives=this.readListFromXML()}}if(B.relatives){F+=","+B.relatives}}}}}this.filter.arrIndividualIds=F.split(",");for(var G=0;G<this.filter.arrIndividualIds.length;G++){var H=this.filter.arrIndividualIds[G];var I=this.readIndividual(H);if(I){for(var C=0;C<I.placeIds.length;C++){this.filter.individualPlaces[I.placeIds[C]]=1}}}}else{document.getElementById("select_relationship").style.display="none"}var E=null;if(this.filter.yearId!=""){E=this.years[this.filter.yearId];if(E){this.filter.datePlaces=new Array();this.readYear(E);for(var C=0;C<E.placeIds.length;C++){this.filter.datePlaces[E.placeIds[C]]=1}}}};this.filterPlaces=function(){this.readFilter();this.removePolylines();var F=new GLatLngBounds();var E=new Array();this.numberOfVisiblePlaces=0;this.numberOfVisiblePlacesWithMarkers=0;this.numberOfVisiblePlacesWithNoCoordinates=0;for(code in this.countries){var I=this.countries[code];if(I){I.visibleCount=0}}var H="";for(var D=0;D<this.places.length;D++){var C=this.places[D];if(C){C.earliestDateForComparisonForIndividual=null;C.referencesForIndividual=null;if(C.isMatchingFilter(this.filter)){C.isVisible=true;this.numberOfVisiblePlaces++;E.push(C);if(C.marker){C.marker.show();this.numberOfVisiblePlacesWithMarkers++}var B=C.getPreferredPlaceMark();if(B){F.extend(B.point)}else{this.numberOfVisiblePlacesWithNoCoordinates++}var I=this.countries[C.getCountryCode()];if(I){I.visibleCount++;if(H==""){H=I.code}else{if(H!=I.code){H="-multiple-"}}}if(this.filter.individualId){this.readPlaceReferences(C);C.setDatesByIndividual(this.filter.individualId)}}else{C.isVisible=false;if(C.marker){C.marker.hide()}}}}this.showLegend2(true);if(H&&H!="-multiple-"){var I=this.countries[H];if(I&&!I.bounds.isEmpty()){F.extend(I.bounds.getSouthWest());F.extend(I.bounds.getNorthEast())}}var G=this.map.getBoundsZoomLevel(F);G=Math.min(G,10);this.map.setZoom(G);this.map.panTo(F.getCenter());this.showVisiblePlaces()};this.onMouseOverLegend=function(B){this.showOnePolyline(B)};this.onMouseOutLegend=function(B){this.showPolylines(true)};this.onMouseClickLegend=function(B){document.getElementById("select_individual").value=B;document.getElementById("select_relationship").selectedIndex=0;this.onFilter()};this.toggleLegendLines=function(){this.hideLegendLines=!this.hideLegendLines;this.showPolylines(!this.hideLegendLines);var B=document.getElementById("toggle_legend_lines");if(B){B.innerHTML=(this.hideLegendLines?TEXT("Show lines"):TEXT("Hide lines"))}B=document.getElementById("legend_lines");if(B){B.style.display=this.hideLegendLines?"none":""}};this.refreshMap=function(B){if(!B){return }this.refreshPlace=B;GDownloadUrl(this.path+"MapCountries.xml",function(D,C){gMap.parseCountriesFromXML(D)});GDownloadUrl(this.path+"MapPlace.xml",function(D,C){gMap.parseAddressFromXML(D)})};this.onShowAllPlaces=function(){if(document.getElementById("select_letters_area").style.display==""){document.getElementById("select_individual_letters").selectedIndex=0;this.onSelectLetter()}else{document.getElementById("select_individual").selectedIndex=0;document.getElementById("select_relationship").selectedIndex=0}document.getElementById("select_year").selectedIndex=0;document.getElementById("select_language").selectedIndex=0;document.getElementById("check_birth").checked=true;document.getElementById("check_death").checked=true;document.getElementById("check_marriage").checked=true;document.getElementById("check_residence").checked=true;document.getElementById("check_photo").checked=true;document.getElementById("check_other").checked=true;this.onFilter()};this.hideAllMarkers=function(){for(var C=0;C<this.places.length;C++){var B=this.places[C];if(B&&B.marker){B.marker.hide()}}this.hideAllAlternatePositions();document.getElementById("places_text").innerHTML=""};this.hideAllAlternatePositions=function(){for(var C=0;C<this.markersForAlternatePositions.length;C++){var B=this.markersForAlternatePositions[C];if(B){B.hide()}}this.markersForAlternatePositions=new Array()};this.createAlternateMarker=function(E,B){var D=E.placeMarks[B];if(!D||!D.point){return null}var C=null;address=D.address;if(!address){address=E.address}var F=new Object;F.title=address;F.icon=new GIcon(G_DEFAULT_ICON);if(B==E.positionOfPreferredPlaceMark){F.icon.image=F.icon.printImage="markerNormal.gif"}else{F.icon.image=F.icon.printImage="markerSuggestion.gif"}C=new GMarker(D.point,F);C.placeId=E.id;C.iPlaceMark=B;C.placeMark=D;C.address=address;GEvent.addListener(C,"click",function(){if(!gMap.waitingForDraggingResponse){gMap.openInfoWindowHtml(C.getLatLng(),C.placeId,C.iPlaceMark)}});GEvent.addListener(C,"mouseover",function(){if(!gMap.waitingForDraggingResponse){gMap.createHighlightMarker(C)}});this.markersForAlternatePositions.push(C);return C};this.onUsePreferredPlaceMarkAddress=function(){this.map.closeInfoWindow();if(!testFTB()){return }var B=this.infoWindow.place;if(!B||B.positionOfPreferredPlaceMark==-1){return }if(FTBCOM.SelectAlternateSuggestion(B.address,B.language,B.positionOfPreferredPlaceMark)){this.refreshMap(B)}};this.onKeepExistingAddress=function(){this.map.closeInfoWindow();if(!testFTB()){return }var B=this.infoWindow.place;if(!B){return }if(FTBCOM.VerifyPlaceAddress(B.address,B.language,B.id)){this.refreshMap(B)}};this.onClickAlternatePlacemarks=function(){this.map.closeInfoWindow();this.hideAllMarkers();this.removePolylines();this.setLegend("");this.showLegend2(false);var J=this.infoWindow.place;if(!J||J.placeMarks.length==0){return }this.map.savePosition();document.getElementById("search").style.display="none";document.getElementById("single").style.display="none";document.getElementById("placesSortPanel").style.display="none";document.getElementById("places_header").innerHTML="";document.getElementById("pins_header").innerHTML="";var L=replaceNewlineWithBR(TEXT("Select one of the alternative suggestions"));var K=document.getElementById("alternativesPanel");var P=new Array();P.push("<table cellspacing='0' cellpadding='0'>");P.push("<tr>");P.push("<td><span class='address'>"+J.address+"</span>");P.push("<span class='title'>&nbsp;:&nbsp;"+TEXT("Alternative suggestions")+"</span></td>");var C="&lt;&lt; "+TEXT("Back from alternative places");var R="gMap.onBackFromAlternatives("+J.id+")";P.push("<td class='right'>"+createCoolButtonHtml("backFromSuggestions",C,R)+"</td>");P.push("</tr>");P.push("<tr><td colspan='2' id='alternativesNote'>"+L.replace("%PLACE%",J.address)+"</td></tr>");P.push("</table>");K.innerHTML=P.join("");K.style.display="";var H=new GLatLngBounds();var P=new Array();P.push("<div class='sideBarArea'>");var Q=new Array();for(iPlaceMark=0;iPlaceMark<J.placeMarks.length;iPlaceMark++){var I=this.createAlternateMarker(J,iPlaceMark);if(!I){continue}this.map.addOverlay(I);H.extend(I.getLatLng());var M=(iPlaceMark==J.positionOfPreferredPlaceMark);var S=M?"pinNormal.gif":"pinSuggestion.gif";var F="gMap.onClickPlacePlaceMark("+iPlaceMark+")";var G="<div class='sideBarRow'> <div class='sideBarPlaceRow'>  <img src='"+S+"' border='0' onclick='"+F+"'>&nbsp;  <a id='sideBar_"+iPlaceMark+"' class='sideBar'   href='javascript:"+F+"'   onmouseover='gMap.onMouseOverPlacePlaceMark("+iPlaceMark+")'    onmouseout='gMap.onMouseOutPlacePlaceMark("+iPlaceMark+")'  >"+address+"</a> </div></div>";if(M){P.push("<div class='sideBarCountry'><b>"+TEXT("Currently on the map")+"</b></div>");P.push(G)}else{Q.push(G)}}if(Q.length>0){P.push("<div class='sideBarSeparator'></div>");P.push("<div class='sideBarCountry'><b>"+TEXT("Alternative suggestions")+"</b></div>");P=P.concat(Q)}var E=J.getPreferredPlaceMark();if(E){var O=E.point;var N="<form id='changeCoordinates'><div class='sideBarCountry'><b>"+TEXT("Or, enter coordinates:")+"</b></div> <div class='sideBarPlaceRow'> <table class='sideBarRow'> <tr>  <td>"+TEXT("Latitude:")+"</td>  <td><input name='lat' size='10' value='"+O.lat()+"' dir='ltr'></td> </tr> <tr>  <td>"+TEXT("Longtitude:")+"</td>  <td><input name='lng' size='10' value='"+O.lng()+"' dir='ltr'></td> </tr> </table></div><div class='sideBarRow'>"+createCoolButtonHtml("btnChangeCoordinates",TEXT_COMMON("Button OK"),"gMap.onChangeCoordinates()")+"</div></form>";P.push(N)}P.push("</div>");var B=this.map.getBoundsZoomLevel(H);B=Math.min(B,10);this.map.setZoom(B);this.map.panTo(H.getCenter());document.getElementById("show_all_places").style.display="none";var D=document.getElementById("places_text");D.innerHTML=P.join("");self.scrollTo(0,0);D.scrollTop=0};this.onBlowUpPlace=function(E,B){var D=this.placesById[E];if(!D||!D.marker){return }var C=D.marker;if(B!=-1){C=this.markersForAlternatePositions[B]}this.blowUpMarker(C)};this.blowUpMarker=function(B){this.map.panTo(B.getLatLng());var C=new Object();C.zoomLevel=Math.max(this.map.getZoom()+4,8);B.showMapBlowup(C)};this.onZoomInPlace=function(){var C=this.infoWindow.place;if(!C||!C.marker){return }var B=null;if(this.infoWindow.iPlaceMark==-1){B=C.getPreferredPlaceMark()}else{B=C.placeMarks[this.infoWindow.iPlaceMark]}if(!B){return }this.zoomInPlaceMark(B)};this.zoomInMarker=function(C,B){this.map.panTo(C.getLatLng());var D=this.map.getZoom();if(D<10){this.map.setZoom(10)}else{this.map.zoomIn()}};this.zoomInPlaceMark=function(B){if(!B){return }this.map.panTo(B.point);this.map.zoomIn()};this.onFixGoodPlace=function(){this.infoWindow.allowFixingGoodPlace=true;this.map.closeInfoWindow();this.showInfoWindow()};this.onShowAllReferencesOfPlace=function(){this.infoWindow.showAllReferences=true;this.map.closeInfoWindow();this.showInfoWindow()};this.onEditPlace=function(){var B=this.infoWindow.place;if(!B){return }if(B.isAddressRefs){if(!testFTB()){return }this.map.closeInfoWindow();if(FTBCOM.EditPlaceAddress(B.address,B.language,B.id)){this.refreshMap(B)}}else{if(!isCharSetAnsi(B.language)){var C=prompt(TEXT("Edit place"),B.address);if(C&&C!=B.address){this.map.closeInfoWindow();if(FTBCOM.EditPlaceText(B.address,B.language,B.id,C)){this.refreshMap(B)}}}else{document.getElementById("edit_place").value=B.address;document.getElementById("edit-place-area").style.display="";document.getElementById("edit-place-link").style.display="none";document.getElementById("edit_place").className=(B.address?"":"error")}}};this.onCancelEditPlace=function(){document.getElementById("edit-place-area").style.display="none";document.getElementById("edit-place-link").style.display=""};this.onApplyEditPlace=function(C){if(!testFTB()){this.map.closeInfoWindow();return }var E=document.getElementById("edit_place");if(!E){return }var D=E.value;if(!D){E.className="error";return }this.map.closeInfoWindow();var B=this.infoWindow.place;if(!B){return }if(FTBCOM.EditPlaceText(B.address,B.language,B.id,D)){this.refreshMap(B)}};this.onRemoveFromMap=function(){this.map.closeInfoWindow();if(!testFTB()){return }var B=this.infoWindow.place;if(!B){return }if(!FTBCOM.RemovePlaceFromMap(B.address,B.language,B.id)){return }this.removedPlaceId=B.id;this.refreshMap(B)};this.onClickAcceptAlternatePlacemark=function(){this.map.closeInfoWindow();if(!testFTB()){return }var D=this.infoWindow.place;if(!D){return }var C=D.placeMarks[this.infoWindow.iPlaceMark];if(!C){return }var B=FTBCOM.SelectAlternateSuggestion(D.address,D.language,this.infoWindow.iPlaceMark);this.onBackFromAlternatives(D.id);if(B){this.refreshMap(D)}};this.onShowAllPinsOfCountry=function(G,J){this.map.closeInfoWindow();var B=G;if(J){B+="_"+J}var C=this.countries[B];if(!C){return }if(C.numberOfPlacesWithNoMarker>=MIN_NUMBER_OF_PLACES_IN_COUNTRY_FOR_WARNING){var L=TEXT("Confirm expanding country");L=L.replace("%NUMBER%",C.numberOfPlacesWithNoMarker);L=L.replace("%COUNTRY%",C.name);if(!confirm(L)){return }}this.totalProgress=this.places.length;this.beginProgress();var H=0;for(var D=0;D<this.places.length;D++){this.incrementProgress();var E=this.places[D];if(!E||!E.isVisible||E.getCountryCode()!=G){continue}var K=E.getStateCode();if(J&&K!=J){continue}if(!E.marker&&this.createMarker(E)){document.images["sideBarImage_"+E.id].src="pinNormal.gif";this.numberOfVisiblePlacesWithMarkers++}if(E.marker){if(C.bounds){C.bounds.extend(E.marker.getLatLng())}H++}if(K){var F=document.getElementById("show_all_country_pins_"+G+"_"+K);if(F){F.style.display="none"}}}this.showNumberOfPinsOnTheMap();var F=document.getElementById("show_all_country_pins_"+B);if(F){F.style.display="none"}if(H>0&&C.bounds){var I=this.map.getBoundsZoomLevel(C.bounds);this.map.setZoom(I);this.map.panTo(C.bounds.getCenter())}this.endProgress()};this.onClickPlace=function(G){if(this.waitingForDraggingResponse){return }var E=this.placesById[G];if(!E){return }var I=false;var H=null;var J=E.getPreferredPlaceMark();if(J&&!E.marker){if(this.createMarker(E)){document.images["sideBarImage_"+G].src="pinNormal.gif";this.numberOfVisiblePlacesWithMarkers++;this.showNumberOfPinsOnTheMap();I++}}if(E.marker){H=E.marker.getLatLng();E.marker.show();var C=null;if(J&&J.countryCode){var B=J.countryCode;if(J.stateCode){B+="_"+J.stateCode}C=this.countries[B]}var D=null;if(C&&C.bounds){D=C.bounds}else{if(J.bounds){D=J.bounds}}if(D&&!D.isEmpty()){var K=Math.min(this.map.getBoundsZoomLevel(D),10);this.map.setZoom(K);this.map.panTo(D.getCenter())}if(C&&I&&C.numberOfPlacesWithNoMarker>0){C.numberOfPlacesWithNoMarker--;if(C.numberOfPlacesWithNoMarker==0){var F=document.getElementById("show_all_country_pins_"+B);if(F){F.style.display="none"}}}}else{}this.openInfoWindowHtml(H,G,-1);this.ensurePlaceVisibleInList(G)};this.onMouseOverPlace=function(D){var B=this.placesById[D];var C=document.getElementById("sideBar_"+D);if(B&&C){C.title=B.tooltip}if(B&&B.marker){this.createHighlightMarker(B.marker)}};this.onMouseOutPlace=function(B){this.removeHighlightMarker()};this.onClickPlacePlaceMark=function(B){var D=this.infoWindow.place;var C=this.markersForAlternatePositions[B];if(D&&C){C.show();this.openInfoWindowHtml(C.getLatLng(),D.id,B)}};this.onMouseOverPlacePlaceMark=function(B){var D=this.infoWindow.place;var C=this.markersForAlternatePositions[B];if(D&&C){C.setImage("markerSelected.gif")}};this.onMouseOutPlacePlaceMark=function(B){var D=this.infoWindow.place;var C=this.markersForAlternatePositions[B];if(D&&C){C.setImage(B==D.positionOfPreferredPlaceMark?"markerNormal.gif":"markerSuggestion.gif")}};this.highlightSideBar=function(D,E){var B=this.placesById[D];if(!B){return }var C=document.getElementById("sideBar_"+D);if(!C){return }C.className=E};this.ensurePlaceVisibleInList=function(D){var E=document.getElementById("places_text");var C=document.getElementById("sideBarRow_"+D);if(!C||!E){return }var F=C.offsetTop-E.scrollTop;var B=E.offsetHeight;var G=20;if(F<0){E.scrollTop=C.offsetTop-G}else{if(F+C.scrollHeight>B){E.scrollTop=C.offsetTop-B+C.scrollHeight+G}}};this.showAreasBasedOnSinglePlace=function(){document.getElementById("search").style.display=(this.isSinglePlace?"none":"");document.getElementById("single").style.display=(this.isSinglePlace?"":"none");document.getElementById("placesSortPanel").style.display=(this.isSinglePlace?"none":"")};this.onBackFromAlternatives=function(B){document.getElementById("alternativesPanel").style.display="none";this.showAreasBasedOnSinglePlace();this.hideAllAlternatePositions();this.onFilter();this.map.returnToSavedPosition();this.ensurePlaceVisibleInList(B)};this.onShowUnmarkedPlaces=function(){document.getElementById("places_not_found_text").style.display="";document.getElementById("places_not_found_toggle").innerHTML="<a href='javascript:gMap.onHideUnmarkedPlaces()'>&#171; "+TEXT("Hide places not found")+"</a>"};this.onHideUnmarkedPlaces=function(){document.getElementById("places_not_found_text").style.display="none";document.getElementById("places_not_found_toggle").innerHTML="<a href='javascript:gMap.onShowUnmarkedPlaces()'>"+TEXT("Show places not found")+" &#187;</a>"};this.sortPlaces=function(){sortBy=document.getElementById("places_sort").value;if(sortBy=="name"){this.places.sort(this.sortPlacesByName)}else{if(sortBy=="count"){this.places.sort(this.sortPlacesByCount)}else{if(sortBy=="country"){this.places.sort(this.sortPlacesByCountry)}else{if(sortBy=="date"){this.places.sort(this.sortPlacesByDate)}}}}};this.onSortPlaces=function(){this.totalProgress=this.places.length;this.beginProgress();this.sortPlaces();this.showVisiblePlaces()};this.createArrowHeadPolyline=function(T,S,X,C){if(T.length<2){return null}var J=T[T.length-1];var H=T[T.length-2];var B=this.map.getZoom();var Q=this.map.getCurrentMapType().getProjection();var E=Q.fromLatLngToPixel(J,B);var D=Q.fromLatLngToPixel(H,B);var P=E.x-D.x;var O=E.y-D.y;var W=Math.sqrt((P*P)+(O*O));var K=Math.atan2(-O,P);var R=K+(Math.PI/4);if(R>Math.PI){R-=2*Math.PI}var M=K-(Math.PI/4);if(M<=(-Math.PI)){M+=2*Math.PI}var Y=new Array();var N=E.x;var L=E.y;var V=N-Math.cos(R)*S;var G=L+Math.sin(R)*S;var U=N-Math.cos(M)*S;var F=L+Math.sin(M)*S;Y.push(Q.fromPixelToLatLng(new GPoint(V,G),B));Y.push(Q.fromPixelToLatLng(new GPoint(N,L),B));Y.push(Q.fromPixelToLatLng(new GPoint(U,F),B));var I=new GPolyline(Y,X,C);return I};this.calculateTooltip=function(C){var B=C.address;var E;if(C.refs==1){E=TEXT("Click to view place with one reference")}else{E=TEXT("Click to view place with references").replace("%NUMBER%",C.refs)}E=E.replace("%PLACE%",B);if(C.addressFound){var F=B.indexOf(C.addressFound);if(F>0){var D=B.substr(F);E+="\n"+TEXT("Located on map tootip").replace("%PLACE%",D)}}C.tooltip=E};this.onBackFromSingleAddress=function(){if(!testFTB()){return false}if(FTBCOM.ReloadData()){location.reload()}};this.onCloseCallout=function(){document.getElementById("calloutWindow").style.display="none"};this.getPhotoFromXmlElement=function(E){var B=getChildElement(E,"photo");if(!B){return null}var G=B.getAttribute("id");var C=getChildElement(B,"file");var F=getChildElement(B,"thumbnail");if(!G||!C||!F){return null}var D=new Object();D.id=G;D.file=C.childNodes[0].nodeValue;D.width=parseInt(C.getAttribute("w"));D.height=parseInt(C.getAttribute("h"));D.thumbnail=F.childNodes[0].nodeValue;D.thumbnailWidth=parseInt(F.getAttribute("w"));D.thumbnailHeight=parseInt(F.getAttribute("h"));this.photos[G]=D;return D};this.readIndividuals=function(F,B){var J=document.getElementById("select_individual");if(!F||!J){return }var E=F.length;for(var H=0;H<E;H++){var I=F[H];if(!I){continue}var D=I.getAttribute("id");var C=getXmlChildText(I,"name");var G=this.addIndividual(D,C);G.count=I.getAttribute("count");G.lifeSpan=getXmlChildText(I,"life");var K=C;if(G.lifeSpan){K+=" : "+G.lifeSpan}if(!this.isBasicUserWithPartialList&&this.numberOfAbortedPlaces==0){K+=" ("+G.count+")"}addSelectOption(J,D,K);if(B){this.incrementProgress()}}};this.parseSearchData=function(Z){var D=GXml.parse(Z);if(!D||!D.documentElement){return }var J=getChildElementsArray(D.documentElement,"letters");if(J){this.totalProgress+=J.length}var T=getChildElementsArray(D.documentElement,"individuals");if(T){this.totalProgress+=T.length}var O=getChildElementsArray(D.documentElement,"years");if(O){this.totalProgress+=O.length}var G=getChildElementsArray(D.documentElement,"languages");if(G){this.totalProgress+=G.length}this.beginProgress();var E=document.getElementById("select_letters_area");var H=document.getElementById("select_individual_letters");var a=document.getElementById("select_individual");if(J){E.style.display="";H.style.display="";a.style.display="none";addSelectOption(H,"","-- "+TEXT("All people")+" --");var X=J.length;for(var R=0;R<X;R++){var P=J[R];if(!P){continue}var b=getXmlChildText(P,"name");var M=b+"...";if(!this.isBasicUserWithPartialList&&this.numberOfAbortedPlaces==0){var F=P.getAttribute("count");M+=" ("+F+")"}addSelectOption(H,b,M);this.incrementProgress()}var N=document.getElementById("calculating_individuals");N.innerHTML="<span class='darkNote'>&#171; "+TEXT("Pick first letter of first name")+"</span>";N.style.display=""}else{if(T){E.style.display="none";H.style.display="none";a.style.display="";addSelectOption(a,"","-- "+TEXT("All people")+" --");this.readIndividuals(T,true)}}var C=document.getElementById("select_year");addSelectOption(C,"","-- "+TEXT("All dates")+" --");var W=O.length;for(var L=0;O&&O&&L<W;L++){var Y=O[L];if(!Y){continue}var Q=Y.getAttribute("value");var F=Y.getAttribute("count");var K=new MapYear(Q,F);this.years[Q]=K;this.sortedYears.push(Q);var M="";if(Q<1900){M=Q+" - "+(parseInt(Q)+99)}else{if(Q<2000){M=Q+" - "+(parseInt(Q)+9)}else{M=Q}}if(!this.isBasicUserWithPartialList&&this.numberOfAbortedPlaces==0){M+=" ("+this.years[Q].count+")"}addSelectOption(C,Q,M);this.incrementProgress()}var S=document.getElementById("select_language");var V=G.length;if(V>1){addSelectOption(S,"","-- "+TEXT("All languages")+" --");for(var B=0;G&&B<V;B++){var I=G[B];if(!I){continue}var U=new Object();U.code=I.getAttribute("code");U.count=I.getAttribute("count");U.name=getXmlChildText(I,"name");this.languages[U.code]=U;if(V>1){var M=U.name;if(!this.isBasicUserWithPartialList&&this.numberOfAbortedPlaces==0){M+=" ("+U.count+")"}addSelectOption(S,U.code,M)}this.incrementProgress()}}else{this.incrementProgress();S.style.display="none"}this.endProgress()};this.getAdvancedSearchData=function(){if(!testFTB()){return false}if(!FTBCOM.GetSearchData()){return false}GDownloadUrl(this.path+"MapSearch.xml",function(D,C){gMap.parseSearchData(D)});var B=document.getElementById("select_relationship");B.options.length=0;this.initializeRelationshipTexts();addSelectOption(B,"me",this.relationshipText.me);addSelectOption(B,"ancestors",this.relationshipText.ancestors);addSelectOption(B,"descendants",this.relationshipText.descendants);addSelectOption(B,"relatives",this.relationshipText.relatives);return true};this.showAdvancedSearch=function(){var B=this.getAdvancedSearchData();document.getElementById("calculating_advanced_search").style.display="none";if(B){document.getElementById("advanced_search").style.display=""}else{document.getElementById("open_advanced_search").style.display=""}};this.onOpenAdvancedSearch=function(){document.getElementById("open_advanced_search").style.display="none";var B=document.getElementById("calculating_advanced_search");if(B){B.innerHTML=TEXT("Loading advanced search");B.style.display=""}setTimeout("gMap.showAdvancedSearch()",1)}}var gMap=null;var FTBCOM=null;function testFTB(){if(!FTBCOM){alert("Cannot communucate with Family Tree Builder");return false}return true}var scr;function setGoogleMapJavaScript(){var A=document.getElementsByTagName("HEAD")[0];scr=document.createElement("script");scr.type="text/javascript";scr.src="http://maps.google.com/maps?file=api&amp;v=2&key=ABQIAAAANMZg4rne7SEHe8dHbXAgrxReBiIj87U3ceTnlQjTYZJtE5SHKxRiVxAngaEFGhG04STCY5KV-msuNw&sensor=false";scr.onreadystatechange=function(){if(scr.readyState=="loaded"||scr.readyState=="complete"){setTimeout("initialize()",1)}};A.appendChild(scr)}function onLoad(){setTimeout("initialize()",1)}function onUnload(){if(isDefined("_mDomain")&&_mDomain=="google.com"){GUnload()}}function initialize(){onResizeWindow();FTBCOM=document.createElement("OBJECT");FTBCOM.classid="CLSID:2F43522E-B0C5-4FF3-9F06-4CDB90F779D5";testFTB();FTBCOM.StartedLoadingMap();if(isDefined("_mDomain")&&_mDomain=="google.com"&&GBrowserIsCompatible()){gMap=new MapPlaces("map_canvas");gMap.initialize();gMap.parseAll()}else{alert("Cannot create map\n\nMake sure you are connected to the Internet")}}function onResizeWindow(){var A=document.body.clientWidth;var B=document.body.clientHeight-110;var D=document.getElementById("places_text");var C=document.getElementById("map_canvas");C.style.width=A-250;C.style.height=B;if(document.getElementById("individualPanel").style.display=="none"){D.style.height=B-28}else{D.style.height=B-132}if(gMap&&gMap.map){gMap.map.checkResize()}}function TEXT(A,B){return gMap.getText(A,B)}function TEXT_COMMON(A){return gMap.getText(A,"CommonMessages")}function onClickPremium(){if(!testFTB()){return }FTBCOM.UpgradeToPremium()}function onPrint(){window.print()}function onAdvancedSearch(){if(gMap.openAdvancedSearch()){}};